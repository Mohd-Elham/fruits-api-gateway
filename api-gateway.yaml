---
# 4.1) NodePort Service for API Gateway
apiVersion: v1
kind: Service
metadata:
  name: api-gateway
spec:
  type: NodePort                   # Expose to host; change to ClusterIP if internal only
  selector:
    app: api-gateway
  ports:
    - name: http
      port: 8080                   # inside-cluster port
      targetPort: 8080
      nodePort: 30080              # host‑accessible port (30000–32767)
---
# 4.2) Deployment for API Gateway
apiVersion: apps/v1
kind: Deployment
metadata:
  name: api-gateway
spec:
  replicas: 1
  selector:
    matchLabels:
      app: api-gateway
  template:
    metadata:
      labels:
        app: api-gateway
    spec:
      containers:
        - name: api-gateway
          image: api-gateway:latest-v4
          imagePullPolicy: IfNotPresent
          ports:
            - containerPort: 8080
          readinessProbe:
            httpGet:
              path: /actuator/health
              port: 8080
            initialDelaySeconds: 10
            periodSeconds: 5
